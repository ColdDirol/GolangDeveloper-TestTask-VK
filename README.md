# Профильное задание на Golang-разработчика в VK Tech

## Запуск
Docker Compose:
```bash
docker-compose up --build app
```
или из корневой директории проекта:
```bash
docker run --name redis -p 6379:6379 -d redis
go run .\cmd\main.go
```

## Ход мыслей:

Первым шагом я решил определить структуры данных, которая будет использоваться для хранения информации о запросах. У нас есть пользователь, есть метки - квыбор пал на map.

Следующим шагом нужно было разработать метод Check, который будет проверять, превышает ли количество запросов от пользователя за последние N секунд заданный порог K. Для этого я сначала определил интервал времени, за который нужно проверять запросы, затем прошелся по всем запросам от пользователя в этом интервале и подсчитал их количество.

Для хранения данных между разными приложениями в самом конце я внедрил Redis - в нем я сохраняю временные метки "удачных" запросов от пользователей, и, при следующем вызове функции Check, считаю количество меток от `текущего времени` до `текущего времени минус заданный интервал в секундах`. Если посчитанное значение меньше максимально установленного значения в конфигурации - то возвращаю false, иначе - флуд замечен, пользователь похой, true.

## Навигация
* [Реализация FloodControl интерфейса](https://github.com/ColdDirol/GolangDeveloper-TestTask-VK/tree/main/internal/flood_control)
* [Тест](https://github.com/ColdDirol/GolangDeveloper-TestTask-VK/tree/main/test)
* [Конфигурационный файл](https://github.com/ColdDirol/GolangDeveloper-TestTask-VK/blob/main/config.json)

## Правила конфигурации
### Конфигурационный файл
```json
{
  "env": "dev",
  "interval_seconds": 10,
  "max_requests": 4,
  "redis": {
    "host": "localhost",
    "port": "6379",
    "password": "",
    "db": 0
  }
}
```

#### ENV:
В переменную env можно установить значения: `local`, `dev`, `prod`.
```json
"env": "dev",
```
От значения зависит уровень и способ логирования: `local` - уровень логирования - Debug, `dev` - уровень логирования - Debug, `prod` - уровень логирования - Info.

#### INTERVAL_SECONDS и MAX_REQUESTS
```json
"interval_seconds": 10,
"max_requests": 4,
```
Интервал в `interval_seconds` в котором разрешено только `max_requests` запросов.

#### REDIS
```json
"redis": {
  "host": "localhost",
  "port": "6379",
  "password": "",
  "db": 0
}
```
`host` - хост, на котором расположен Redis - рекомендуется оставить `localhost`, так как при инициализации через Docker Compose в поле хоста автоматически записывается переменная окружения `redis`.

`port` - порт Redis

`password` - пустой, мы секретов не храним (пока что)

`db` - индекс базы данных для подключения клиента (по умолчанию равен нулю)
